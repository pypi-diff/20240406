# Comparing `tmp/spirems-0.1.3-py3-none-any.whl.zip` & `tmp/spirems-0.1.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,39 +1,44 @@
-Zip file size: 26751 bytes, number of entries: 37
--rw-rw-rw-  2.0 fat      546 b- defN 24-Apr-04 14:30 spirems/__init__.py
+Zip file size: 560526 bytes, number of entries: 42
+-rw-rw-rw-  2.0 fat      546 b- defN 24-Apr-06 11:20 spirems/__init__.py
 -rw-rw-rw-  2.0 fat      878 b- defN 24-Mar-31 06:11 spirems/error_code.py
 -rw-rw-rw-  2.0 fat     1009 b- defN 24-Apr-04 14:11 spirems/log.py
 -rw-rw-rw-  2.0 fat     4807 b- defN 24-Mar-31 09:46 spirems/msg_helper.py
--rw-rw-rw-  2.0 fat     6597 b- defN 24-Apr-04 14:09 spirems/publisher.py
--rw-rw-rw-  2.0 fat    13447 b- defN 24-Apr-04 14:05 spirems/server.py
+-rw-rw-rw-  2.0 fat     8809 b- defN 24-Apr-06 10:32 spirems/publisher.py
+-rw-rw-rw-  2.0 fat    16136 b- defN 24-Apr-06 11:04 spirems/server.py
 -rw-rw-rw-  2.0 fat     5255 b- defN 24-Mar-31 18:32 spirems/sms.py
--rw-rw-rw-  2.0 fat     5462 b- defN 24-Apr-04 14:12 spirems/subscriber.py
+-rw-rw-rw-  2.0 fat     6818 b- defN 24-Apr-06 10:29 spirems/subscriber.py
 -rw-rw-rw-  2.0 fat       48 b- defN 24-Apr-04 14:27 spirems/image_io/__init__.py
--rw-rw-rw-  2.0 fat     1396 b- defN 24-Apr-02 11:34 spirems/image_io/adaptor.py
--rw-rw-rw-  2.0 fat      549 b- defN 24-Apr-02 11:34 spirems/image_io/recv_testcase.py
+-rw-rw-rw-  2.0 fat     6990 b- defN 24-Apr-06 11:17 spirems/image_io/a2rl_gs.py
+-rw-rw-rw-  2.0 fat     1440 b- defN 24-Apr-06 11:25 spirems/image_io/adaptor.py
+-rw-rw-rw-  2.0 fat      551 b- defN 24-Apr-04 14:49 spirems/image_io/recv_testcase.py
 -rw-rw-rw-  2.0 fat       17 b- defN 24-Mar-31 07:05 spirems/logs/README.md
 -rw-rw-rw-  2.0 fat       54 b- defN 24-Mar-25 14:45 spirems/msgs/_sys_msgs/HeartBeat.json
 -rw-rw-rw-  2.0 fat       99 b- defN 24-Mar-25 17:12 spirems/msgs/_sys_msgs/Publisher.json
--rw-rw-rw-  2.0 fat       82 b- defN 24-Mar-25 17:07 spirems/msgs/_sys_msgs/Result.json
+-rw-rw-rw-  2.0 fat       92 b- defN 24-Apr-05 16:23 spirems/msgs/_sys_msgs/Result.json
 -rw-rw-rw-  2.0 fat       57 b- defN 24-Mar-27 09:42 spirems/msgs/_sys_msgs/SmsTopicList.json
 -rw-rw-rw-  2.0 fat      100 b- defN 24-Mar-25 17:13 spirems/msgs/_sys_msgs/Subscriber.json
 -rw-rw-rw-  2.0 fat       52 b- defN 24-Mar-27 15:25 spirems/msgs/_sys_msgs/Suspend.json
--rw-rw-rw-  2.0 fat       70 b- defN 24-Mar-25 17:02 spirems/msgs/_sys_msgs/TopicUpload.json
+-rw-rw-rw-  2.0 fat       78 b- defN 24-Apr-06 09:14 spirems/msgs/_sys_msgs/TopicDown.json
+-rw-rw-rw-  2.0 fat       80 b- defN 24-Apr-05 16:23 spirems/msgs/_sys_msgs/TopicUpload.json
 -rw-rw-rw-  2.0 fat       54 b- defN 24-Mar-27 15:26 spirems/msgs/_sys_msgs/Unsuspend.json
 -rw-rw-rw-  2.0 fat      109 b- defN 24-Mar-24 10:29 spirems/msgs/sensor_msgs/Image.json
 -rw-rw-rw-  2.0 fat       67 b- defN 24-Mar-24 10:30 spirems/msgs/std_msgs/Boolean.json
 -rw-rw-rw-  2.0 fat       79 b- defN 24-Mar-24 10:30 spirems/msgs/std_msgs/BooleanMultiArray.json
 -rw-rw-rw-  2.0 fat       48 b- defN 24-Mar-24 10:35 spirems/msgs/std_msgs/Null.json
 -rw-rw-rw-  2.0 fat       64 b- defN 24-Mar-26 11:39 spirems/msgs/std_msgs/Number.json
 -rw-rw-rw-  2.0 fat       76 b- defN 24-Mar-24 10:30 spirems/msgs/std_msgs/NumberMultiArray.json
 -rw-rw-rw-  2.0 fat       63 b- defN 24-Mar-24 10:30 spirems/msgs/std_msgs/String.json
 -rw-rw-rw-  2.0 fat       75 b- defN 24-Mar-24 10:30 spirems/msgs/std_msgs/StringMultiArray.json
+-rw-rw-rw-  2.0 fat   116940 b- defN 24-Mar-12 14:41 spirems/res/fradmcn.ttf
+-rw-rw-rw-  2.0 fat   175292 b- defN 22-May-07 05:20 spirems/res/msyh_boot.ttf
+-rw-rw-rw-  2.0 fat   353153 b- defN 24-Apr-06 11:11 spirems/res/racecar.jpg
 -rw-rw-rw-  2.0 fat       48 b- defN 24-Apr-04 14:27 spirems/sys_monit/__init__.py
--rw-rw-rw-  2.0 fat     2271 b- defN 24-Apr-03 02:38 spirems/sys_monit/a2rl_sys_monit.py
+-rw-rw-rw-  2.0 fat     2271 b- defN 24-Apr-05 09:09 spirems/sys_monit/a2rl_sys_monit.py
 -rw-rw-rw-  2.0 fat     3487 b- defN 24-Apr-03 02:38 spirems/sys_monit/psutil_pub.py
--rw-rw-rw-  2.0 fat     5241 b- defN 24-Apr-04 14:31 spirems-0.1.3.data/scripts/sms.py
--rw-rw-rw-  2.0 fat    11558 b- defN 24-Apr-04 14:31 spirems-0.1.3.dist-info/LICENSE
--rw-rw-rw-  2.0 fat     1248 b- defN 24-Apr-04 14:31 spirems-0.1.3.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 24-Apr-04 14:31 spirems-0.1.3.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        8 b- defN 24-Apr-04 14:31 spirems-0.1.3.dist-info/top_level.txt
--rw-rw-r--  2.0 fat     3150 b- defN 24-Apr-04 14:31 spirems-0.1.3.dist-info/RECORD
-37 files, 68263 bytes uncompressed, 21643 bytes compressed:  68.3%
+-rw-rw-rw-  2.0 fat     5241 b- defN 24-Apr-06 11:29 spirems-0.1.4.data/scripts/sms.py
+-rw-rw-rw-  2.0 fat    11558 b- defN 24-Apr-06 11:29 spirems-0.1.4.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat     1248 b- defN 24-Apr-06 11:29 spirems-0.1.4.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 24-Apr-06 11:29 spirems-0.1.4.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        8 b- defN 24-Apr-06 11:29 spirems-0.1.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat     3574 b- defN 24-Apr-06 11:29 spirems-0.1.4.dist-info/RECORD
+42 files, 727463 bytes uncompressed, 554768 bytes compressed:  23.7%
```

## zipnote {}

```diff
@@ -21,14 +21,17 @@
 
 Filename: spirems/subscriber.py
 Comment: 
 
 Filename: spirems/image_io/__init__.py
 Comment: 
 
+Filename: spirems/image_io/a2rl_gs.py
+Comment: 
+
 Filename: spirems/image_io/adaptor.py
 Comment: 
 
 Filename: spirems/image_io/recv_testcase.py
 Comment: 
 
 Filename: spirems/logs/README.md
@@ -48,14 +51,17 @@
 
 Filename: spirems/msgs/_sys_msgs/Subscriber.json
 Comment: 
 
 Filename: spirems/msgs/_sys_msgs/Suspend.json
 Comment: 
 
+Filename: spirems/msgs/_sys_msgs/TopicDown.json
+Comment: 
+
 Filename: spirems/msgs/_sys_msgs/TopicUpload.json
 Comment: 
 
 Filename: spirems/msgs/_sys_msgs/Unsuspend.json
 Comment: 
 
 Filename: spirems/msgs/sensor_msgs/Image.json
@@ -78,35 +84,44 @@
 
 Filename: spirems/msgs/std_msgs/String.json
 Comment: 
 
 Filename: spirems/msgs/std_msgs/StringMultiArray.json
 Comment: 
 
+Filename: spirems/res/fradmcn.ttf
+Comment: 
+
+Filename: spirems/res/msyh_boot.ttf
+Comment: 
+
+Filename: spirems/res/racecar.jpg
+Comment: 
+
 Filename: spirems/sys_monit/__init__.py
 Comment: 
 
 Filename: spirems/sys_monit/a2rl_sys_monit.py
 Comment: 
 
 Filename: spirems/sys_monit/psutil_pub.py
 Comment: 
 
-Filename: spirems-0.1.3.data/scripts/sms.py
+Filename: spirems-0.1.4.data/scripts/sms.py
 Comment: 
 
-Filename: spirems-0.1.3.dist-info/LICENSE
+Filename: spirems-0.1.4.dist-info/LICENSE
 Comment: 
 
-Filename: spirems-0.1.3.dist-info/METADATA
+Filename: spirems-0.1.4.dist-info/METADATA
 Comment: 
 
-Filename: spirems-0.1.3.dist-info/WHEEL
+Filename: spirems-0.1.4.dist-info/WHEEL
 Comment: 
 
-Filename: spirems-0.1.3.dist-info/top_level.txt
+Filename: spirems-0.1.4.dist-info/top_level.txt
 Comment: 
 
-Filename: spirems-0.1.3.dist-info/RECORD
+Filename: spirems-0.1.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## spirems/__init__.py

```diff
@@ -6,13 +6,13 @@
 from spirems.subscriber import Subscriber
 from spirems.publisher import Publisher
 from spirems.server import Server
 from spirems.image_io.adaptor import cvimg2sms, sms2cvimg
 from spirems.msg_helper import get_all_msg_types
 
 
-__version__ = "0.1.3"
+__version__ = "0.1.4"
 
 __all__ = [
     'a2rl_pub', 'a2rl_sub', 'cvimg2sms', 'cvimg2sms', 'get_all_msg_types',
     'Subscriber', 'Publisher', 'Server'
 ]
```

## spirems/publisher.py

```diff
@@ -28,83 +28,132 @@
         all_types = get_all_msg_types()
         if topic_type not in all_types.keys():
             raise ValueError('The topic type is not present, please check...')
         url_state = check_topic_url(topic_url)
         if url_state != 0:
             raise ValueError('The input topic_url is invalid, please verify...')
 
+        self.upload_id = 0
+        self.last_send_time = 0.0
+        self.last_upload_time = 0.0
+        self.uploaded_ids = dict()  # already uploaded IDs
+        self.transmission_delay = 0.0  # second
+        self.package_loss_rate = 0.0  # 0-100 %
         self.force_quit = False
-        self._link()
+        try:
+            self._link()
+        except Exception as e:
+            pass
         self.running = True
         self.suspended = False
         self.err_cnt = 0
         self.start()
         heartbeat_thread = threading.Thread(target=self.heartbeat)
         self.heartbeat_running = True
-        self.publish_available = False
         heartbeat_thread.start()
 
     def kill(self):
         self.force_quit = True
 
     def wait_key(self):
         try:
             while not self.force_quit:
                 time.sleep(0.5)
         except KeyboardInterrupt:
             logger.info('stopped by keyboard')
             self.kill()
             self.join()
 
+    def _delay_packet_loss_rate(self):
+        delay = 0.0
+        delay_cnt = 0
+        package_loss_rate = 0.0
+        package_len = len(self.uploaded_ids)
+        invalid_keys = []
+        for key, val in self.uploaded_ids.items():
+            if val[1] >= 0:
+                delay += val[1]
+                delay_cnt += 1
+            if time.time() - val[0] > 5:  # keep 5 second for each msg
+                invalid_keys.append(key)
+                package_loss_rate += 1
+
+        for key in invalid_keys:
+            del self.uploaded_ids[key]
+
+        if delay_cnt > 0:
+            delay = delay / delay_cnt
+        self.transmission_delay = delay
+        if package_len > 0:
+            package_loss_rate = package_loss_rate / package_len
+        self.package_loss_rate = package_loss_rate
+
     def heartbeat(self):
         while self.heartbeat_running:
             all_types = get_all_msg_types()
             try:
                 apply_topic = all_types['_sys_msgs::Publisher'].copy()
                 apply_topic['topic_type'] = self.topic_type
                 apply_topic['url'] = self.topic_url
-                self.client_socket.sendall(encode_msg(apply_topic))
+                if time.time() - self.last_send_time >= 1.0:
+                    self.client_socket.sendall(encode_msg(apply_topic))
+                    self.last_send_time = time.time()
+
+                self._delay_packet_loss_rate()
             except Exception as e:
                 logger.error("heartbeat: {}".format(e))
             time.sleep(1)
             if self.force_quit:
                 break
 
     def _link(self):
         self.client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
         self.client_socket.settimeout(5)
         self.client_socket.connect((self.ip, self.port))
 
     def publish(self, topic) -> bool:
-        if not self.suspended and self.running and self.publish_available:
-            try:
-                topic_upload = get_all_msg_types()['_sys_msgs::TopicUpload'].copy()
-                topic_upload['topic'] = topic
-                self.client_socket.sendall(encode_msg(topic_upload))
-                return True
-            except socket.timeout:
-                pass
+        if not self.suspended and self.running:
+            if time.time() - self.last_upload_time > self.transmission_delay:
+                try:
+                    # print("avg_delay: {}".format(self.transmission_delay))
+                    topic = topic.copy()
+                    topic['timestamp'] = time.time()
+                    topic_upload = get_all_msg_types()['_sys_msgs::TopicUpload'].copy()
+                    topic_upload['topic'] = topic
+                    self.upload_id += 1
+                    topic_upload['id'] = self.upload_id
+                    self.uploaded_ids[self.upload_id] = [time.time(), -1]  # Now, Delay
+                    self.client_socket.sendall(encode_msg(topic_upload))
+                    self.last_send_time = time.time()
+                    self.last_upload_time = time.time()
+                    return True
+                except socket.timeout:
+                    pass
+            else:
+                logger.warn("There is a large network delay ({}), suspend sending once.".format(self.transmission_delay))
         return False
 
     def _parse_msg(self, msg):
         success, decode_data = decode_msg(msg)
         if success and decode_data['type'] == '_sys_msgs::Suspend':
             self.suspended = True
         elif success and decode_data['type'] == '_sys_msgs::Unsuspend':
             self.suspended = False
         elif success and decode_data['type'] == '_sys_msgs::Result':
-            if decode_data['error_code'] == 0:
+            if decode_data['id'] > 0:
                 self.err_cnt = 0
-                self.publish_available = True
-            else:
+                recv_id = decode_data['id']
+                # print(decode_data['id'])
+                if recv_id in self.uploaded_ids:
+                    self.uploaded_ids[recv_id][1] = time.time() - self.uploaded_ids[recv_id][0]
+            if decode_data['error_code'] > 0:
                 self.err_cnt += 1
                 if self.err_cnt > 5:
                     self.suspended = True
-                    self.running = False
-            # logger.debug(decode_data)
+            # logger.debug("{}, {}".format(self.suspended, decode_data))
         elif success and decode_data['type'] != '_sys_msgs::HeartBeat':
             logger.debug(decode_data)
 
     def run(self):
         data = b''
         last_data = b''
         big_msg = 0
@@ -150,34 +199,35 @@
             except Exception as e:
                 logger.error(e)
                 self.running = False
 
             while not self.running:
                 if self.force_quit:
                     break
-                self.publish_available = False
+                self.suspended = True
                 time.sleep(5)
                 try:
                     self.client_socket.close()
                     self._link()
                     self.running = True
+                    self.suspended = False
                 except Exception as e:
                     logger.error(e)
                 logger.info('Running={}, Wait ...'.format(self.running))
                 data = b''
                 last_data = b''
                 big_msg = 0
 
 
 if __name__ == '__main__':
     pub = Publisher('/sensors/hello/a12', 'std_msgs::NumberMultiArray',
                     ip='127.0.0.1')
     # pub = Publisher('/hello1', 'std_msgs::NumberMultiArray')
     cnt = 0
     while True:
-        time.sleep(0.05)
+        time.sleep(0.2)
         tpc = get_all_msg_types()['std_msgs::NumberMultiArray'].copy()
         tpc['data'] = [random.random() for i in range(2)]
-        if cnt == 0:
-            tpc['type'] = 'std_msgs::Number'
+        # if cnt == 0:
+        #     tpc['type'] = 'std_msgs::Number'
         pub.publish(tpc)
         cnt += 1
```

## spirems/server.py

```diff
@@ -134,61 +134,107 @@
         self.client_socket = client_socket
         self._server = _server
         self.running = True
         self.pub_type = None
         self.sub_type = None
         self._quit = False
         self.pub_suspended = False
+        self.sub_suspended = False
+        self.pass_id = 0
+        self.passed_ids = dict()  # already passed IDs
         self.last_send_time = time.time()
+        self.last_upload_time = 0.0
+        self.transmission_delay = 0.0  # second
+        self.package_loss_rate = 0.0  # 0-100 %
         heartbeat_thread = threading.Thread(target=self.heartbeat)
         heartbeat_thread.start()
 
+    def _delay_packet_loss_rate(self):
+        delay = 0.0
+        delay_cnt = 0
+        package_loss_rate = 0.0
+        package_len = len(self.passed_ids)
+        invalid_keys = []
+        for key, val in self.passed_ids.items():
+            if val[1] >= 0:
+                delay += val[1]
+                delay_cnt += 1
+            if time.time() - val[0] > 3:  # keep 3 second for each msg
+                invalid_keys.append(key)
+                package_loss_rate += 1
+
+        for key in invalid_keys:
+            del self.passed_ids[key]
+
+        if delay_cnt > 0:
+            delay = delay / delay_cnt
+        self.transmission_delay = delay
+        if package_len > 0:
+            package_loss_rate = package_loss_rate / package_len
+        self.package_loss_rate = package_loss_rate
+
     def heartbeat(self):
         while self.running:
             hb_msg = get_all_msg_types()['_sys_msgs::HeartBeat'].copy()
             try:
-                if time.time() - self.last_send_time > 1.0:
+                if time.time() - self.last_send_time >= 1.0:
                     self.client_socket.sendall(encode_msg(hb_msg))
                     self.last_send_time = time.time()
                 if self.pub_type is not None:  # self.pub_suspended
                     all_topics = get_public_topic()
                     url = all_topics['from_key'][self.client_key]['url']
                     if len(all_topics['from_topic'][url]['subs']) > 0:
                         unsuspend_msg = get_all_msg_types()['_sys_msgs::Unsuspend'].copy()
                         self.client_socket.sendall(encode_msg(unsuspend_msg))
                         self.last_send_time = time.time()
                         self.pub_suspended = False
+                if self.sub_type is not None:  # catch delay issue
+                    self._delay_packet_loss_rate()
                 time.sleep(1)
             except Exception as e:
                 logger.error("heartbeat: {}".format(e))
                 self.running = False
 
             if not self.running and not self._quit:
                 logger.info('Quit by heartbeat')
                 self.quit()
                 self._server.quit(self.client_key)
 
-    def _forwarding_topic(self, topic: dict):
+    def sub_forwarding_topic(self, topic: dict):
+        # print(self.transmission_delay)
+        if not self.sub_suspended and time.time() - self.last_upload_time > self.transmission_delay:
+            self.pass_id += 1
+            passed_msg = get_all_msg_types()['_sys_msgs::TopicDown'].copy()
+            passed_msg['id'] = self.pass_id
+            passed_msg['topic'] = topic
+            self.passed_ids[self.pass_id] = [time.time(), -1]  # Now, Delay
+            self.client_socket.sendall(encode_msg(passed_msg))
+            self.last_send_time = time.time()
+            self.last_upload_time = time.time()
+
+    def _pub_forwarding_topic(self, topic: dict):
         all_topics = get_public_topic()
         url = all_topics['from_key'][self.client_key]['url']
         if len(all_topics['from_topic'][url]['subs']) == 0:
             suspend_msg = get_all_msg_types()['_sys_msgs::Suspend'].copy()
             self.client_socket.sendall(encode_msg(suspend_msg))
             self.last_send_time = time.time()
             self.pub_suspended = True
 
-        enc_msg = encode_msg(topic)
+        # enc_msg = encode_msg(topic)
+        # print(topic)
         for sub in all_topics['from_topic'][url]['subs']:
             try:
-                self._server.msg_forwarding(sub, enc_msg)
+                self._server.msg_forwarding(sub, topic)
             except Exception as e:
                 logger.debug('ForwardException: {}'.format(e))
 
     def _parse_msg(self, data: bytes):
         response = get_all_msg_types()['_sys_msgs::Result'].copy()
+        no_reply = False
         success, msg = decode_msg(data)
         if success:
             if '_sys_msgs::Publisher' == msg['type']:
                 if 'topic_type' in msg and 'url' in msg:
                     error = check_publish_url_type(msg['url'], msg['topic_type'], self.client_key)
                     if self.sub_type is not None:
                         error = 209
@@ -207,33 +253,49 @@
                     if error == 0:
                         self.sub_type = msg['topic_type']
                         update_subscriber(msg['url'], msg['topic_type'], self.client_key)
                     else:
                         response = ec2msg(error)
                 else:
                     response = ec2msg(206)
+            elif '_sys_msgs::Suspend' == msg['type'] and self.sub_type is not None:
+                self.sub_suspended = True
+                no_reply = True
+            elif '_sys_msgs::Unsuspend' == msg['type'] and self.sub_type is not None:
+                self.sub_suspended = False
+                no_reply = True
             elif '_sys_msgs::SmsTopicList' == msg['type']:
                 response['error_code'] = 0
                 url_types = []
                 for key, val in get_public_topic()['from_topic'].items():
                     url_types.append(key + "," + val['type'] + "," + str(len(val['subs'])))
                 response['data'] = ";".join(url_types)
             elif '_sys_msgs::TopicUpload' == msg['type']:
+                response['id'] = msg['id']
+                # response['data'] = msg['timestamp']
                 if self.pub_type is None:
                     response = ec2msg(207)
                 elif 'topic' in msg and 'type' in msg['topic'] and msg['topic']['type'] == self.pub_type:
-                    self._forwarding_topic(msg['topic'])
+                    self._pub_forwarding_topic(msg['topic'])
                 else:
                     response = ec2msg(208)
+            elif '_sys_msgs::Result' == msg['type']:
+                if self.sub_type is not None and msg['id'] in self.passed_ids:
+                    recv_id = msg['id']
+                    self.passed_ids[recv_id][1] = time.time() - self.passed_ids[recv_id][0]
+                no_reply = True
+            else:
+                no_reply = True
         else:
             response = ec2msg(101)
             logger.debug(data)
 
-        self.client_socket.sendall(encode_msg(response))
-        self.last_send_time = time.time()
+        if not no_reply:
+            self.client_socket.sendall(encode_msg(response))
+            self.last_send_time = time.time()
 
     def run(self):
         data = b''
         last_data = b''
         big_msg = 0
         while self.running:
             # tt1 = time.time()
@@ -318,17 +380,17 @@
 
                 pipeline = Pipeline(client_key, client_socket, self)
                 self.connected_clients[client_key] = pipeline
                 pipeline.start()
             except socket.timeout:
                 pass
 
-    def msg_forwarding(self, client_key: str, msg: bytes):
+    def msg_forwarding(self, client_key: str, topic: dict):
         if client_key in self.connected_clients:
-            self.connected_clients[client_key].client_socket.sendall(msg)
+            self.connected_clients[client_key].sub_forwarding_topic(topic)
 
     def quit(self, client_key=None):
         if client_key is None:
             for k, c in self.connected_clients.items():
                 c.quit()
             self.listening = False
         else:
```

## spirems/subscriber.py

```diff
@@ -29,16 +29,20 @@
         all_types = get_all_msg_types()
         if topic_type not in all_types.keys():
             raise ValueError('The topic type is not present, please check...')
         url_state = check_topic_url(topic_url)
         if url_state != 0:
             raise ValueError('The input topic_url is invalid, please verify...')
 
+        self.last_send_time = 0.0
         self.force_quit = False
-        self._link()
+        try:
+            self._link()
+        except Exception as e:
+            pass
         self.running = True
         self.start()
         heartbeat_thread = threading.Thread(target=self.heartbeat)
         self.heartbeat_running = True
         heartbeat_thread.start()
 
     def kill(self):
@@ -53,35 +57,59 @@
             self.kill()
             self.join()
 
     def heartbeat(self):
         while self.heartbeat_running:
             all_types = get_all_msg_types()
             try:
-                apply_topic = all_types['_sys_msgs::Subscriber'].copy()
-                apply_topic['topic_type'] = self.topic_type
-                apply_topic['url'] = self.topic_url
-                self.client_socket.sendall(encode_msg(apply_topic))
+                if time.time() - self.last_send_time >= 1.0:
+                    apply_topic = all_types['_sys_msgs::Subscriber'].copy()
+                    apply_topic['topic_type'] = self.topic_type
+                    apply_topic['url'] = self.topic_url
+                    self.client_socket.sendall(encode_msg(apply_topic))
+                    self.last_send_time = time.time()
             except Exception as e:
                 logger.error("heartbeat: {}".format(e))
             time.sleep(1)
             if self.force_quit:
                 break
 
     def _link(self):
         self.client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
         self.client_socket.settimeout(5)
         self.client_socket.connect((self.ip, self.port))
         self.client_socket.settimeout(5)
 
+    def suspend(self):
+        if self.running:
+            try:
+                suspend_msg = get_all_msg_types()['_sys_msgs::Suspend'].copy()
+                self.client_socket.sendall(encode_msg(suspend_msg))
+                self.last_send_time = time.time()
+            except Exception as e:
+                pass
+
+    def unsuspend(self):
+        if self.running:
+            try:
+                suspend_msg = get_all_msg_types()['_sys_msgs::Unsuspend'].copy()
+                self.client_socket.sendall(encode_msg(suspend_msg))
+                self.last_send_time = time.time()
+            except Exception as e:
+                pass
+
     def _parse_msg(self, msg):
+        response = get_all_msg_types()['_sys_msgs::Result'].copy()
         success, decode_data = decode_msg(msg)
-        if success and decode_data['type'] != '_sys_msgs::HeartBeat' and decode_data['type'] != '_sys_msgs::Result':
+        if success and decode_data['type'] == '_sys_msgs::TopicDown':
             # print("{:.3f}: {}".format(time.time() - decode_data['timestamp'], decode_data))
-            self.callback_func(decode_data)
+            self.callback_func(decode_data['topic'])
+            response['id'] = decode_data['id']
+            self.client_socket.sendall(encode_msg(response))
+            self.last_send_time = time.time()
         elif not success:
             logger.debug(msg)
 
     def run(self):
         data = b''
         last_data = b''
         big_msg = 0
@@ -147,8 +175,19 @@
 def callback_f(msg):
     print(msg)
 
 
 if __name__ == '__main__':
     sub = Subscriber('/sensors/hello/a12', 'std_msgs::NumberMultiArray', callback_f,
                      ip='127.0.0.1')
+    sus = False
+    while True:
+        if not sus:
+            print("sub.suspend()")
+            sub.suspend()
+            sus = True
+        else:
+            print("sub.unsuspend()")
+            sub.unsuspend()
+            sus = False
+        time.sleep(10)
     # sub = Subscriber('/hello1', 'std_msgs::NumberMultiArray', callback_f)
```

## spirems/image_io/adaptor.py

```diff
@@ -1,11 +1,14 @@
 #!/usr/bin/env python3
 # -*- coding:utf-8 -*-
 
-import cv2
+try:
+    import cv2
+except Exception as e:
+    pass
 import numpy as np
 import base64
 from spirems.msg_helper import get_all_msg_types
 from spirems.publisher import Publisher
 
 
 def cvimg2sms(img: np.ndarray) -> dict:
```

## spirems/image_io/recv_testcase.py

```diff
@@ -5,15 +5,15 @@
 import time
 import cv2
 
 
 def callback_f(msg):
     # print(time.time() - msg['timestamp'])
     img2 = sms2cvimg(msg)
-    img2 = cv2.resize(img2, (1280, 720))
+    # img2 = cv2.resize(img2, (1280, 720))
     cv2.imshow('img', img2)
     cv2.waitKey(5)
 
 
 if __name__ == '__main__':
     sub = Subscriber('/sensors/camera/image_raw', 'sensor_msgs::Image', callback_f,
                      ip='47.91.115.171')  # 47.91.115.171
```

## spirems/msgs/_sys_msgs/Result.json

### Pretty-printed

 * *Similarity: 0.8%*

 * *Differences: {"'id'": '0'}*

```diff
@@ -1,6 +1,7 @@
 {
     "data": "",
     "error_code": 0,
+    "id": 0,
     "timestamp": 0.0,
     "type": "_sys_msgs::Result"
 }
```

## spirems/msgs/_sys_msgs/TopicUpload.json

### Pretty-printed

 * *Similarity: 0.75%*

 * *Differences: {"'id'": '0'}*

```diff
@@ -1,5 +1,6 @@
 {
+    "id": 0,
     "timestamp": 0.0,
     "topic": {},
     "type": "_sys_msgs::TopicUpload"
 }
```

## Comparing `spirems-0.1.3.data/scripts/sms.py` & `spirems-0.1.4.data/scripts/sms.py`

 * *Files identical despite different names*

## Comparing `spirems-0.1.3.dist-info/LICENSE` & `spirems-0.1.4.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `spirems-0.1.3.dist-info/METADATA` & `spirems-0.1.4.dist-info/METADATA`

 * *Files 7% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: spirems
-Version: 0.1.3
+Version: 0.1.4
 Author: jin&team
 Author-email: renjin@bit.edu.cn
 Classifier: Programming Language :: Python :: 3
 Classifier: Operating System :: OS Independent
 Requires-Python: >=3.8
 Description-Content-Type: text/markdown
 License-File: LICENSE
```

## Comparing `spirems-0.1.3.dist-info/RECORD` & `spirems-0.1.4.dist-info/RECORD`

 * *Files 17% similar despite different names*

```diff
@@ -1,37 +1,42 @@
-spirems/__init__.py,sha256=BkYEwk3FUC0Rn5FuKcRT4ucDvgtIGI7S__ZiHOCQSNo,546
+spirems/__init__.py,sha256=LwFlIBDvJ0WvWlMoSJ37qNImeR6hvOdCeYecLU51ZDU,546
 spirems/error_code.py,sha256=CrFS5cLLLrLKRxGoTGoMeW4w9f8TjmVYZ-7FdHmZdp0,878
 spirems/log.py,sha256=JujtjV1_AQWNdkEmnooBG8zCzXwl6ykl4J5H_BkAtQ8,1009
 spirems/msg_helper.py,sha256=e6rNT3mjiQy_7VH6oSj6M2PQokPuNujiWBvN0MADiBI,4807
-spirems/publisher.py,sha256=KqSIj5NAOxE6mFNRDwQdH9UMnPzix4bpnyXwI5lXoVY,6597
-spirems/server.py,sha256=DlxlEOg8klelmT31JEQoAVw1s6KQFlZljB0Z8H1akmk,13447
+spirems/publisher.py,sha256=6TsmzdFpRC9dQStxkpmmGBgKCHzuTbnEtPBUqv6vFx8,8809
+spirems/server.py,sha256=oeWs6lgsUZgskF5W4rJ0L3ulH-Xh7UA5BkIpwf4miQg,16136
 spirems/sms.py,sha256=4uAFAU8W-wDOTVs6UitoQfzUWkmJeU55mIcEgrUqAGs,5255
-spirems/subscriber.py,sha256=75usIv27l-rYhHLfiwS9wEmFRnrci_h8xSQcioBgMJA,5462
+spirems/subscriber.py,sha256=fB9Z7d4QyLasOK8KtEN4UMYj5reqU7s6lAWnC3pDZYk,6818
 spirems/image_io/__init__.py,sha256=M11gWrr6dDI3LEeCVFCvvONgzfKA8qxwPtMNbnbW1AA,48
-spirems/image_io/adaptor.py,sha256=YyLEXYV43YHHz9T1gMCPmcVTdVsllHHfVmXxtrCjaPU,1396
-spirems/image_io/recv_testcase.py,sha256=1mVqLjAvsjeJL2osUsq4iyppvNSPulRppq9lCBJfyRY,549
+spirems/image_io/a2rl_gs.py,sha256=4b8nQI1mhM8j2KDaQ7-rVKK5Vu4eC7GZ175jkFrwElw,6990
+spirems/image_io/adaptor.py,sha256=_SxU_0-tBj3SQhJikDsOrGrVEr1-6B_RWGWRF3Bxr_8,1440
+spirems/image_io/recv_testcase.py,sha256=Dfw9uYKAWDpHKAXOSDHnsp9YiWUwHJ1T4yHvju4vZsI,551
 spirems/logs/README.md,sha256=-A-iurCwjSy1aV-LUkB1QZa3ORQifwKkclC3yMh2N9U,17
 spirems/msgs/_sys_msgs/HeartBeat.json,sha256=36MqpL_AjS3SDBzbCXGZf0vlGmqfqMnQWHnmjJLrKKs,54
 spirems/msgs/_sys_msgs/Publisher.json,sha256=6XQMxBGWvsey7j59eY7BEPHgtEsFA3LffQ57F4Z_gJw,99
-spirems/msgs/_sys_msgs/Result.json,sha256=sl7DnthrkRaP6_Ur70zdg-G64QUChvnkkCZpBaMsh-0,82
+spirems/msgs/_sys_msgs/Result.json,sha256=JTP2tNy4NViIuG4R9db_fmYrTgxC3JK6CQtPUdn82Cs,92
 spirems/msgs/_sys_msgs/SmsTopicList.json,sha256=AKBGrqD5rnAaFKzA6zy9cW0V_JpQl8Q7oY4j_UBtX7E,57
 spirems/msgs/_sys_msgs/Subscriber.json,sha256=zzxyDaNmGnAbSwAvmEPHOkIB2mjy82OfhVQN8vaa-NA,100
 spirems/msgs/_sys_msgs/Suspend.json,sha256=OB-vSPGCh4zFZlUjco6RYX-G3fszRV-M231QdTxEfoM,52
-spirems/msgs/_sys_msgs/TopicUpload.json,sha256=3oGAGylyiCiChCm651DeBIi5RbbjMnQcQrZKub9MtRY,70
+spirems/msgs/_sys_msgs/TopicDown.json,sha256=Sx1eXuNJIQwYegnc4vhutQMb16yVs3tnNsjqQaCsm5w,78
+spirems/msgs/_sys_msgs/TopicUpload.json,sha256=jYsZzQBZKihyyoXp3lNQXT9GhqbbSXP9Me_0jVmdWCE,80
 spirems/msgs/_sys_msgs/Unsuspend.json,sha256=pZADfgaQWOSP11zIdZNLQVhSk-Bc9XQnzYhu4p3MY38,54
 spirems/msgs/sensor_msgs/Image.json,sha256=liQeU9nvuqdtBrFRGjvOPAup4JVOtj-MHQUVcYYc8y0,109
 spirems/msgs/std_msgs/Boolean.json,sha256=a5V2SeTxwamfkdtxysAUWPCUxT6NrwrCurW4-jN43Ug,67
 spirems/msgs/std_msgs/BooleanMultiArray.json,sha256=veLyvBpYFztR_7ZyO4ICnvxiT5eWCGaP3yrrJHbLtBY,79
 spirems/msgs/std_msgs/Null.json,sha256=MGBvN6uIpgEpaYZQhgUfFRHXBpx7FsvngISqBvBciHI,48
 spirems/msgs/std_msgs/Number.json,sha256=cZ8O3NrZ8pFE3cnEnGhe8jbye5j6HHSoQiV_s9xw4_Q,64
 spirems/msgs/std_msgs/NumberMultiArray.json,sha256=doBT3ukrotfw0UpcFqWPDFkLsxctpOKDtX8HkbZ6aNA,76
 spirems/msgs/std_msgs/String.json,sha256=jcBACqMkZOe3wW59EupJkB7ZzJ7hXhZ_10NHHRUccwQ,63
 spirems/msgs/std_msgs/StringMultiArray.json,sha256=PN8fg_P5Zqa7BjBaptMQyoR_IuOppAetGOsg-Nvbpuk,75
+spirems/res/fradmcn.ttf,sha256=SrD02HmRy9qRpiU2nigExPuIlpzbHkvYO2vzfQfPnP0,116940
+spirems/res/msyh_boot.ttf,sha256=MlzgvMtO_ghMf56FP1XPkP_TMw7YOsLVRftCyGXWOYg,175292
+spirems/res/racecar.jpg,sha256=oUm4lHuO3iDcs5VgFIPXGn8AODd6tMEAoR5vg6HXUSo,353153
 spirems/sys_monit/__init__.py,sha256=M11gWrr6dDI3LEeCVFCvvONgzfKA8qxwPtMNbnbW1AA,48
 spirems/sys_monit/a2rl_sys_monit.py,sha256=KfP0Vd_D3oFX-ZACm6OmuWRI6tVl0vR-FisMW28A1BI,2271
 spirems/sys_monit/psutil_pub.py,sha256=PQWs5vAq916xPNyGIPtWDJ1MJZLzkFLqgsDHJ5pJKH4,3487
-spirems-0.1.3.data/scripts/sms.py,sha256=eaqngSfCzgPtkBXjw0nZ82o17pLHW2ZPDxXku6xkR94,5241
-spirems-0.1.3.dist-info/LICENSE,sha256=HrhfyXIkWY2tGFK11kg7vPCqhgh5DcxleloqdhrpyMY,11558
-spirems-0.1.3.dist-info/METADATA,sha256=iTzg4npUNbTSWvP4u-kzCnT3VPBo2JAOJkXZ_Yq7UpY,1248
-spirems-0.1.3.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-spirems-0.1.3.dist-info/top_level.txt,sha256=ra9zu_vB-BRVXDwvqhouFCHIwnalKkMGq3JmTZijtmE,8
-spirems-0.1.3.dist-info/RECORD,,
+spirems-0.1.4.data/scripts/sms.py,sha256=eaqngSfCzgPtkBXjw0nZ82o17pLHW2ZPDxXku6xkR94,5241
+spirems-0.1.4.dist-info/LICENSE,sha256=HrhfyXIkWY2tGFK11kg7vPCqhgh5DcxleloqdhrpyMY,11558
+spirems-0.1.4.dist-info/METADATA,sha256=bsxv6Nh1RwOTgLSTjhkx7FRh0FEQF506y1iYdXgEtdE,1248
+spirems-0.1.4.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+spirems-0.1.4.dist-info/top_level.txt,sha256=ra9zu_vB-BRVXDwvqhouFCHIwnalKkMGq3JmTZijtmE,8
+spirems-0.1.4.dist-info/RECORD,,
```

